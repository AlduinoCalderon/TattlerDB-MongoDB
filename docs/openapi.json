{
  "openapi": "3.0.3",
  "info": {
    "title": "TattlerDB API",
    "description": "TattlerDB REST API â€” restaurants and Google reviews",
    "version": "1.0.0",
    "contact": { "name": "Tattler Support", "email": "support@tattler.mx" }
  },
  "servers": [
    { "url": "http://localhost:3001/api", "description": "Local" }
  ],
  "tags": [
    { "name": "restaurants", "description": "Restaurant operations" },
    { "name": "reviews", "description": "Google reviews operations" }
  ],
  "paths": {
    "/restaurants": {
      "get": {
        "tags": ["restaurants"],
        "summary": "List restaurants",
        "parameters": [
          { "in": "query", "name": "page", "schema": { "type": "integer", "default": 1 } },
          { "in": "query", "name": "limit", "schema": { "type": "integer", "default": 20 } }
        ],
        "responses": { "200": { "description": "List of restaurants", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RestaurantList" } } } } }
      },
      "post": {
        "tags": ["restaurants"],
        "summary": "Create or upsert a restaurant (by data_id)",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RestaurantCreate" } } } },
        "responses": { "201": { "description": "Created/Updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RestaurantResponse" } } } } }
      }
    },

    "/restaurants/{data_id}": {
      "get": {
        "tags": ["restaurants"],
        "summary": "Get restaurant by data_id",
        "parameters": [ { "in": "path", "name": "data_id", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Restaurant found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RestaurantResponse" } } } }, "404": { "description": "Not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } }
      },
      "put": {
        "tags": ["restaurants"],
        "summary": "Update restaurant (partial)",
        "parameters": [ { "in": "path", "name": "data_id", "required": true, "schema": { "type": "string" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RestaurantUpdate" } } } },
        "responses": { "200": { "description": "Updated","content": { "application/json": { "schema": { "$ref": "#/components/schemas/RestaurantResponse" } } } }, "404": { "description": "Not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } }
      },
      "delete": {
        "tags": ["restaurants"],
        "summary": "Soft-delete restaurant",
        "parameters": [ { "in": "path", "name": "data_id", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Deleted", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteResponse" } } } }, "404": { "description": "Not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } }
      }
    },

    "/restaurants/search/location": {
      "get": {
        "tags": ["restaurants"],
        "summary": "Search restaurants by location",
        "parameters": [
          { "in": "query", "name": "longitude", "required": true, "schema": { "type": "number" } },
          { "in": "query", "name": "latitude", "required": true, "schema": { "type": "number" } },
          { "in": "query", "name": "distance", "schema": { "type": "integer", "default": 1000 } }
        ],
        "responses": { "200": { "description": "Search results", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LocationSearchResponse" } } } } }
      }
    },

    "/restaurants/search/text": {
      "get": {
        "tags": ["restaurants"],
        "summary": "Text search for restaurants",
        "parameters": [ { "in": "query", "name": "q", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Search results", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TextSearchResponse" } } } } }
      }
    },

    "/reviews": {
      "get": {
        "tags": ["reviews"],
        "summary": "List reviews",
        "parameters": [ { "in": "query", "name": "page", "schema": { "type": "integer", "default": 1 } }, { "in": "query", "name": "limit", "schema": { "type": "integer", "default": 20 } } ],
        "responses": { "200": { "description": "List of reviews", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReviewList" } } } } }
      },
      "post": {
        "tags": ["reviews"],
        "summary": "Create or upsert review",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReviewCreate" } } } },
        "responses": { "201": { "description": "Created/Upserted", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReviewResponse" } } } } }
      }
    },

    "/reviews/{review_id}": {
      "get": {
        "tags": ["reviews"],
        "summary": "Get review by review_id or _id",
        "parameters": [ { "in": "path", "name": "review_id", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Review", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReviewResponse" } } } }, "404": { "description": "Not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } }
      },
      "put": {
        "tags": ["reviews"],
        "summary": "Update review by review_id",
        "parameters": [ { "in": "path", "name": "review_id", "required": true, "schema": { "type": "string" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReviewUpdate" } } } },
        "responses": { "200": { "description": "Updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReviewResponse" } } } } }
      },
      "delete": {
        "tags": ["reviews"],
        "summary": "Soft-delete review",
        "parameters": [ { "in": "path", "name": "review_id", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Deleted", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteResponse" } } } } }
      }
    },

    "/reviews/data/{data_id}": {
      "get": {
        "tags": ["reviews"],
        "summary": "Get reviews for a restaurant (by data_id)",
        "parameters": [ { "in": "path", "name": "data_id", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "List of reviews for the place", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReviewList" } } } } }
      }
    }
  },

  "components": {
    "schemas": {
      "Restaurant": {
        "type": "object",
        "properties": {
          "data_id": { "type": "string" },
          "google_place_id": { "type": "string" },
          "nombre": { "type": "string" },
          "address": { "type": "string" },
          "phone": { "type": "string" },
          "rating": { "type": "number" },
          "reviews": { "type": "integer" },
          "types": { "type": "array", "items": { "type": "string" } },
          "thumbnail": { "type": "string" },
          "ubicacion": { "type": "object", "properties": { "type": { "type": "string" }, "coordinates": { "type": "array", "items": { "type": "number" } } } },
          "deleted": { "type": "boolean" },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" }
        }
      },

      "RestaurantCreate": { "type": "object", "properties": { "data_id": { "type": "string" }, "google_place_id": { "type": "string" }, "nombre": { "type": "string" }, "address": { "type": "string" }, "phone": { "type": "string" }, "ubicacion": { "type": "object" } } },

      "RestaurantUpdate": { "type": "object", "properties": { "nombre": { "type": "string" }, "address": { "type": "string" }, "phone": { "type": "string" }, "rating": { "type": "number" }, "ubicacion": { "type": "object" } } },

      "RestaurantResponse": { "type": "object", "properties": { "success": { "type": "boolean" }, "data": { "$ref": "#/components/schemas/Restaurant" } } },

      "RestaurantList": { "type": "object", "properties": { "success": { "type": "boolean" }, "data": { "type": "object", "properties": { "restaurants": { "type": "array", "items": { "$ref": "#/components/schemas/Restaurant" } }, "pagination": { "type": "object" } } } } },

      "LocationSearchResponse": { "type": "object", "properties": { "success": { "type": "boolean" }, "data": { "type": "object" } } },

      "TextSearchResponse": { "type": "object", "properties": { "success": { "type": "boolean" }, "data": { "type": "object" } } },

      "Review": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "review_id": { "type": "string" },
          "data_id": { "type": "string" },
          "google_place_id": { "type": "string" },
          "author": { "type": "string" },
          "rating": { "type": "number" },
          "text": { "type": "string" },
          "date": { "type": "string", "format": "date-time" },
          "images": { "type": "array", "items": { "type": "string" } },
          "raw_google_review": { "type": "object" },
          "normalized_at": { "type": "string", "format": "date-time" }
        }
      },

      "ReviewCreate": { "type": "object", "required": ["review_id", "data_id"], "properties": { "review_id": { "type": "string" }, "data_id": { "type": "string" }, "google_place_id": { "type": "string" }, "author": { "type": "string" }, "rating": { "type": "number" }, "text": { "type": "string" }, "images": { "type": "array", "items": { "type": "string" } }, "raw_google_review": { "type": "object" } } },

      "ReviewUpdate": { "type": "object", "properties": { "author": { "type": "string" }, "rating": { "type": "number" }, "text": { "type": "string" } } },

      "ReviewResponse": { "type": "object", "properties": { "success": { "type": "boolean" }, "data": { "$ref": "#/components/schemas/Review" } } },

      "ReviewList": { "type": "object", "properties": { "success": { "type": "boolean" }, "data": { "type": "object", "properties": { "docs": { "type": "array", "items": { "$ref": "#/components/schemas/Review" } }, "pagination": { "type": "object" } } } } },

      "DeleteResponse": { "type": "object", "properties": { "success": { "type": "boolean" }, "data": { "type": "object" } } },

      "ErrorResponse": { "type": "object", "properties": { "success": { "type": "boolean" }, "error": { "type": "object" } } }
    }
  }
}